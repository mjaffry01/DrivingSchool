<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Best in the West Driving School ‚Äî Demo</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { scroll-behavior: smooth; }
    .hero {
      background: linear-gradient(135deg, rgba(0,0,0,.65), rgba(0,0,0,.35)),
        url("https://images.unsplash.com/photo-1525609004556-c46c7d6cf023?auto=format&fit=crop&w=1400&q=60") center/cover no-repeat;
      color: #fff;
      padding: 90px 0;
    }
    .section { padding: 70px 0; }
    .badge-soft { background: rgba(13,110,253,.12); color: #0d6efd; }
    .card-shadow { box-shadow: 0 10px 24px rgba(0,0,0,.08); }
    .mini { font-size: .9rem; color: #6c757d; }
    .admin-table-wrap { max-height: 360px; overflow: auto; }

    .star-btn {
      font-size: 1.6rem;
      background: transparent;
      border: 0;
      padding: 0 .15rem;
      line-height: 1;
      cursor: pointer;
    }
    .star-btn.active { filter: drop-shadow(0 0 2px rgba(0,0,0,.2)); }
    .stars-wrap { user-select: none; }
  </style>
</head>

<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg bg-white border-bottom sticky-top">
  <div class="container">
    <a class="navbar-brand fw-bold" href="#home">üöó Best in the West</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="nav" class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto gap-1">
        <li class="nav-item"><a class="nav-link" href="#about">About</a></li>
        <li class="nav-item"><a class="nav-link" href="#services">Services</a></li>
        <li class="nav-item"><a class="nav-link" href="#success">Driving Success</a></li>
        <li class="nav-item"><a class="nav-link" href="#review">Leave Review</a></li>
        <li class="nav-item"><a class="nav-link" href="#contact">Contact</a></li>
      </ul>

      <div class="d-flex ms-lg-3 gap-2">
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#bookingModal">
          Book Now
        </button>
        <button class="btn btn-outline-secondary" data-bs-toggle="offcanvas" data-bs-target="#adminPanel">
          Admin
        </button>
      </div>
    </div>
  </div>
</nav>

<!-- Hero -->
<header id="home" class="hero">
  <div class="container">
    <div class="row align-items-center g-4">
      <div class="col-lg-7">
        <span class="badge badge-soft rounded-pill px-3 py-2 mb-3">Patient ‚Ä¢ Professional ‚Ä¢ Test-ready</span>
        <h1 class="display-5 fw-bold mb-3">Become a confident driver ‚Äî faster.</h1>
        <p class="lead mb-4">
          Lessons tailored for learners, overseas conversions, and test preparation.
          Learn safe habits, master local routes, and feel calm behind the wheel.
        </p>
        <div class="d-flex flex-wrap gap-2">
          <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#bookingModal">Book a Lesson</button>
          <a class="btn btn-outline-light btn-lg" href="#services">View Services</a>
        </div>
        <div class="mt-4 d-flex flex-wrap gap-3 mini">
          <div>‚≠ê 4.9+ rating (demo)</div>
          <div>‚úÖ Dual-control training car (demo)</div>
          <div>üìç Western suburbs coverage (demo)</div>
        </div>
      </div>

      <div class="col-lg-5">
        <div class="bg-white text-dark rounded-4 p-4 card-shadow">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <div class="fw-semibold">Quick Booking</div>
              <div class="mini">We‚Äôll confirm by call/email</div>
            </div>
            <span class="badge text-bg-success">MVP</span>
          </div>

          <hr>

          <form id="quickBookingForm" novalidate>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Full Name</label>
                <input type="text" class="form-control" name="name" required>
                <div class="invalid-feedback">Name is required.</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Phone</label>
                <input type="tel" class="form-control" name="phone" required>
                <div class="invalid-feedback">Phone is required.</div>
              </div>
              <div class="col-md-12">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" name="email" required>
                <div class="invalid-feedback">Valid email is required.</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Preferred Date</label>
                <input type="date" class="form-control" name="date" required>
                <div class="invalid-feedback">Date is required.</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Preferred Time</label>
                <input type="time" class="form-control" name="time" required>
                <div class="invalid-feedback">Time is required.</div>
              </div>
              <div class="col-12">
                <label class="form-label">Service</label>
                <select class="form-select" name="service" required>
                  <option value="">Select‚Ä¶</option>
                  <option>Learner Lessons</option>
                  <option>Test Preparation</option>
                  <option>Overseas Licence Conversion</option>
                  <option>Refresher Lessons</option>
                </select>
                <div class="invalid-feedback">Please select a service.</div>
              </div>
              <div class="col-12">
                <button class="btn btn-primary w-100" type="submit">Request Booking</button>
                <div id="quickBookingMsg" class="small mt-2"></div>
              </div>
            </div>
          </form>

        </div>
      </div>
    </div>
  </div>
</header>

<!-- About -->
<section id="about" class="section">
  <div class="container">
    <div class="row g-4 align-items-center">
      <div class="col-lg-6">
        <h2 class="fw-bold">About the School</h2>
        <p class="text-secondary">
          We focus on calm coaching, real road experience, and clear test strategies.
          Lessons are adapted to your level ‚Äî from nervous beginners to test-ready practice.
        </p>
        <div class="d-flex flex-wrap gap-2">
          <span class="badge rounded-pill text-bg-light border">‚úÖ Safety-first coaching</span>
          <span class="badge rounded-pill text-bg-light border">‚úÖ Route familiarity</span>
          <span class="badge rounded-pill text-bg-light border">‚úÖ Confidence building</span>
          <span class="badge rounded-pill text-bg-light border">‚úÖ Mock tests</span>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="p-4 rounded-4 bg-light border">
          <div class="fw-semibold mb-2">What you get</div>
          <ul class="mb-0">
            <li>Structured lesson plan</li>
            <li>Parking + roundabouts + merging practice</li>
            <li>Feedback after each session</li>
            <li>Test day guidance (optional)</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Services -->
<section id="services" class="section bg-light">
  <div class="container">
    <div class="d-flex justify-content-between align-items-end mb-3">
      <div>
        <h2 class="fw-bold mb-1">Services</h2>
        <div class="text-secondary">Choose a plan that suits your goal.</div>
      </div>
      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#bookingModal">Book Now</button>
    </div>

    <div class="row g-3">
      <div class="col-md-6 col-lg-3">
        <div class="card h-100 card-shadow">
          <div class="card-body">
            <h5 class="card-title fw-bold">Learner Lessons</h5>
            <p class="card-text text-secondary">Start strong with safe habits & controls.</p>
          </div>
        </div>
      </div>
      <div class="col-md-6 col-lg-3">
        <div class="card h-100 card-shadow">
          <div class="card-body">
            <h5 class="card-title fw-bold">Test Preparation</h5>
            <p class="card-text text-secondary">Mock tests + common mistakes fixing.</p>
          </div>
        </div>
      </div>
      <div class="col-md-6 col-lg-3">
        <div class="card h-100 card-shadow">
          <div class="card-body">
            <h5 class="card-title fw-bold">Overseas Conversion</h5>
            <p class="card-text text-secondary">Adapt to local rules & driving style.</p>
          </div>
        </div>
      </div>
      <div class="col-md-6 col-lg-3">
        <div class="card h-100 card-shadow">
          <div class="card-body">
            <h5 class="card-title fw-bold">Refresher Lessons</h5>
            <p class="card-text text-secondary">For nervous drivers or after a long break.</p>
          </div>
        </div>
      </div>
    </div>

  </div>
</section>

<!-- Driving Success + Testimonials (dynamic) -->
<section id="success" class="section">
  <div class="container">
    <div class="row g-4">
      <div class="col-lg-6">
        <h2 class="fw-bold">Driving Success</h2>
        <p class="text-secondary">
          A simple approach: learn the skill ‚Üí repeat it calmly ‚Üí simulate the test ‚Üí fix weak areas.
        </p>
        <div class="p-4 bg-light border rounded-4">
          <div class="fw-semibold mb-2">Lesson Flow</div>
          <ol class="mb-0">
            <li>Warm-up (basic control check)</li>
            <li>Main skill focus (merging/parking/roundabouts)</li>
            <li>Route practice (local areas)</li>
            <li>Feedback + next plan</li>
          </ol>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="d-flex justify-content-between align-items-end mb-2">
          <div>
            <h3 class="fw-bold mb-0">Testimonials</h3>
            <div class="mini text-secondary">Real reviews appear here after customers submit feedback.</div>
          </div>
          <a class="btn btn-outline-primary btn-sm" href="#review">Leave Review</a>
        </div>

        <div id="testimonialsRow" class="row g-3">
          <!-- filled by JS -->
        </div>
      </div>

    </div>
  </div>
</section>

<!-- Leave Review -->
<section id="review" class="section bg-light">
  <div class="container">
    <div class="row g-4 align-items-start">
      <div class="col-lg-6">
        <h2 class="fw-bold">Leave a Review</h2>
        <p class="text-secondary">
          After your lesson, you‚Äôll receive a <b>Service ID</b>. Enter it below to leave your rating and testimony.
        </p>

        <div class="p-4 bg-white border rounded-4 card-shadow">
          <form id="reviewForm" novalidate>
            <div class="mb-3">
              <label class="form-label">Service ID</label>
              <input type="text" class="form-control" name="service_id" placeholder="e.g., BW-100012" required>
              <div class="invalid-feedback">Service ID is required.</div>
            </div>

            <div class="mb-3">
              <label class="form-label">Your Rating</label>
              <div class="stars-wrap" id="stars">
                <button type="button" class="star-btn" data-value="1">‚≠ê</button>
                <button type="button" class="star-btn" data-value="2">‚≠ê</button>
                <button type="button" class="star-btn" data-value="3">‚≠ê</button>
                <button type="button" class="star-btn" data-value="4">‚≠ê</button>
                <button type="button" class="star-btn" data-value="5">‚≠ê</button>
                <span class="mini ms-2" id="ratingLabel">0/5</span>
              </div> 
              <input type="hidden" name="rating" id="ratingInput" required>
              <div class="invalid-feedback d-block" id="ratingError" style="display:none;">Rating is required.</div>
            </div>

            <div class="mb-3">
              <label class="form-label">Testimony</label>
              <textarea class="form-control" name="testimony" rows="4" placeholder="Share your experience..." required></textarea>
              <div class="invalid-feedback">Please write your testimony.</div>
            </div>

            <button class="btn btn-primary" type="submit">Submit Review</button>
            <div id="reviewMsg" class="small mt-2"></div>
          </form>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="p-4 border rounded-4 bg-white">
          <div class="fw-semibold mb-2">How it works</div>
          <ol class="mb-0">
            <li>You book a lesson.</li>
            <li>When the service is completed, we give you a <b>Service ID</b>.</li>
            <li>You enter the Service ID here and leave your rating.</li>
            <li>Your review appears in Testimonials (after validation).</li>
          </ol>
          <hr>
          <div class="mini text-secondary">
            MVP note: This stores data in the browser (localStorage). For real business use, connect to a backend + DB.
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Contact -->
<section id="contact" class="section">
  <div class="container">
    <div class="row g-4">
      <div class="col-lg-6">
        <h2 class="fw-bold">Contact</h2>
        <p class="text-secondary">Call, email, or send a message. We‚Äôll get back quickly.</p>
        <div class="p-4 border rounded-4">
          <div class="mb-2"><span class="fw-semibold">Phone:</span> <a href="tel:+61000000000">+61 000 000 000</a></div>
          <div class="mb-2"><span class="fw-semibold">Email:</span> <a href="mailto:hello@example.com">hello@example.com</a></div>
          <div class="mini text-secondary">Update these with real details.</div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="bg-light border rounded-4 p-4">
          <div class="fw-semibold mb-2">Send a message</div>
          <form id="contactForm" novalidate>
            <div class="mb-3">
              <label class="form-label">Name</label>
              <input class="form-control" name="name" required>
              <div class="invalid-feedback">Name is required.</div>
            </div>
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input class="form-control" name="email" type="email" required>
              <div class="invalid-feedback">Valid email is required.</div>
            </div>
            <div class="mb-3">
              <label class="form-label">Message</label>
              <textarea class="form-control" name="message" rows="4" required></textarea>
              <div class="invalid-feedback">Message is required.</div>
            </div>
            <button class="btn btn-primary" type="submit">Send</button>
            <div id="contactMsg" class="small mt-2"></div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<footer class="py-4 border-top">
  <div class="container d-flex flex-wrap justify-content-between align-items-center gap-2">
    <div class="mini">¬© <span id="year"></span> Best in the West Driving School ‚Äî Demo</div>
    <div class="mini">
      <a class="text-decoration-none me-3" href="#home">Top</a>
      <a class="text-decoration-none" href="#review">Review</a>
    </div>
  </div>
</footer>

<!-- Booking Modal -->
<div class="modal fade" id="bookingModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content rounded-4">
      <div class="modal-header">
        <h5 class="modal-title fw-bold">Book a Lesson</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="bookingForm" novalidate>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Full Name</label>
              <input type="text" class="form-control" name="name" required>
              <div class="invalid-feedback">Name is required.</div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Phone</label>
              <input type="tel" class="form-control" name="phone" required>
              <div class="invalid-feedback">Phone is required.</div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" name="email" required>
              <div class="invalid-feedback">Valid email is required.</div>
            </div>
            <div class="col-md-6">
              <label class="form-label">Service</label>
              <select class="form-select" name="service" required>
                <option value="">Select‚Ä¶</option>
                <option>Learner Lessons</option>
                <option>Test Preparation</option>
                <option>Overseas Licence Conversion</option>
                <option>Refresher Lessons</option>
              </select>
              <div class="invalid-feedback">Please select a service.</div>
            </div>

            <div class="col-md-4">
              <label class="form-label">Preferred Date</label>
              <input type="date" class="form-control" name="date" required>
              <div class="invalid-feedback">Date is required.</div>
            </div>
            <div class="col-md-4">
              <label class="form-label">Preferred Time</label>
              <input type="time" class="form-control" name="time" required>
              <div class="invalid-feedback">Time is required.</div>
            </div>
            <div class="col-md-4">
              <label class="form-label">Transmission</label>
              <select class="form-select" name="transmission" required>
                <option value="">Select‚Ä¶</option>
                <option>Automatic</option>
                <option>Manual</option>
              </select>
              <div class="invalid-feedback">Select transmission.</div>
            </div>

            <div class="col-12">
              <label class="form-label">Notes (optional)</label>
              <textarea class="form-control" name="notes" rows="3"></textarea>
            </div>

            <div class="col-12 d-flex justify-content-between align-items-center">
              <div id="bookingMsg" class="small"></div>
              <button class="btn btn-primary" type="submit">Submit Booking Request</button>
            </div>
          </div>
        </form>

        <hr class="my-4">
        <div class="mini text-secondary">
          Demo note: After completing the service, a Service ID is used to submit feedback.
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Admin Offcanvas -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="adminPanel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title fw-bold">Admin ‚Äî Bookings & Reviews</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">

    <div class="d-flex gap-2 mb-3">
      <button id="refreshAdmin" class="btn btn-outline-primary btn-sm">Refresh</button>
      <button id="clearAll" class="btn btn-outline-danger btn-sm">Clear All</button>
      <button id="exportAll" class="btn btn-outline-secondary btn-sm">Export JSON</button>
    </div>

    <div class="fw-semibold mb-2">Bookings</div>
    <div class="admin-table-wrap mb-4">
      <table class="table table-sm align-middle">
        <thead class="table-light position-sticky top-0">
          <tr>
            <th>Service ID</th>
            <th>Date/Time</th>
            <th>Name</th>
            <th>Service</th>
          </tr>
        </thead>
        <tbody id="adminBookingsRows">
          <tr><td colspan="4" class="text-secondary mini">No bookings yet.</td></tr>
        </tbody>
      </table>
    </div>

    <div class="fw-semibold mb-2">Reviews</div>
    <div class="admin-table-wrap">
      <table class="table table-sm align-middle">
        <thead class="table-light position-sticky top-0">
          <tr>
            <th>Service ID</th>
            <th>Rating</th>
            <th>Testimony</th>
          </tr>
        </thead>
        <tbody id="adminReviewsRows">
          <tr><td colspan="3" class="text-secondary mini">No reviews yet.</td></tr>
        </tbody>
      </table>
    </div>

    <div class="mini text-secondary mt-3">
      MVP: All data stored in localStorage.
    </div>
  </div>
</div>

<!-- JS -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // ---------- Storage Keys ----------
  const STORAGE_BOOKINGS = "drivingSchoolBookings_v2";
  const STORAGE_REVIEWS  = "drivingSchoolReviews_v1";

  // ---------- Helpers ----------
  function escapeHtml(str) {
    return String(str).replace(/[&<>"']/g, s => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[s]));
  }

  function validateForm(formEl) {
    if (!formEl.checkValidity()) {
      $(formEl).addClass("was-validated");
      return false;
    }
    return true;
  }

  function setMsg($el, text, ok) {
    $el.text(text).removeClass("text-danger text-success")
      .addClass(ok ? "text-success" : "text-danger");
  }

  function getJson(key) {
    try { return JSON.parse(localStorage.getItem(key) || "[]"); }
    catch { return []; }
  }
  function setJson(key, val) {
    localStorage.setItem(key, JSON.stringify(val));
  }

  // Generate a simple unique Service ID (demo)
  function generateServiceId() {
    const n = Math.floor(100000 + Math.random() * 900000);
    return `BW-${n}`;
  }

  function toObject(formEl) {
    const data = {};
    $(formEl).serializeArray().forEach(({name, value}) => data[name] = value.trim());
    return data;
  }

  // ---------- Render ----------
  function renderTestimonials() {
    const reviews = getJson(STORAGE_REVIEWS);
    const $row = $("#testimonialsRow");

    if (!reviews.length) {
      $row.html(`
        <div class="col-12">
          <div class="p-3 border rounded-4">
            <div class="fw-semibold">No reviews yet</div>
            <div class="mini text-secondary">Be the first to leave a review after your lesson.</div>
          </div>
        </div>
      `);
      return;
    }

    // show latest 4
    const top = reviews.slice(0, 4);
    const html = top.map(r => `
      <div class="col-md-6">
        <div class="p-3 border rounded-4 h-100">
          <div class="d-flex justify-content-between">
            <div class="fw-semibold">${escapeHtml(r.customer_name || "Customer")}</div>
            <div class="mini">${"‚≠ê".repeat(r.rating || 0)}${"‚òÜ".repeat(5-(r.rating||0))}</div>
          </div>
          <div class="mini text-secondary">Service ID: ${escapeHtml(r.service_id)}</div>
          <div class="text-secondary mt-2 mini">${escapeHtml(r.testimony)}</div>
        </div>
      </div>
    `).join("");

    $row.html(html);
  }

  function renderAdmin() {
    const bookings = getJson(STORAGE_BOOKINGS);
    const reviews  = getJson(STORAGE_REVIEWS);

    const $b = $("#adminBookingsRows");
    const $r = $("#adminReviewsRows");

    if (!bookings.length) {
      $b.html('<tr><td colspan="4" class="text-secondary mini">No bookings yet.</td></tr>');
    } else {
      $b.html(bookings.map(b => `
        <tr>
          <td class="mini fw-semibold">${escapeHtml(b.service_id)}</td>
          <td class="mini">${escapeHtml((b.date||"") + " " + (b.time||""))}</td>
          <td>${escapeHtml(b.name || "")}</td>
          <td class="mini">${escapeHtml(b.service || "")}</td>
        </tr>
      `).join(""));
    }

    if (!reviews.length) {
      $r.html('<tr><td colspan="3" class="text-secondary mini">No reviews yet.</td></tr>');
    } else {
      $r.html(reviews.map(rv => `
        <tr>
          <td class="mini fw-semibold">${escapeHtml(rv.service_id)}</td>
          <td class="mini">${"‚≠ê".repeat(rv.rating || 0)}</td>
          <td class="mini">${escapeHtml(rv.testimony)}</td>
        </tr>
      `).join(""));
    }
  }

  // ---------- Star Rating UI ----------
  function setStars(val) {
    $("#ratingInput").val(val);
    $("#ratingLabel").text(`${val}/5`);
    $("#ratingError").hide();

    $("#stars .star-btn").each(function(){
      const v = Number($(this).data("value"));
      $(this).toggleClass("active", v <= val);
      $(this).css("opacity", v <= val ? "1" : ".4");
    });
  }

  // ---------- Init ----------
  $(function(){
    $("#year").text(new Date().getFullYear());
    renderTestimonials();
    renderAdmin();

    // Stars click
    $("#stars .star-btn").on("click", function(){
      setStars(Number($(this).data("value")));
    });

    // Quick booking (stores only)
    $("#quickBookingForm").on("submit", function(e){
      e.preventDefault();
      if (!validateForm(this)) return;

      const booking = toObject(this);
      booking.createdAt = new Date().toISOString();
      booking.service_id = generateServiceId();
      booking.status = "Booked";

      const bookings = getJson(STORAGE_BOOKINGS);
      bookings.unshift(booking);
      setJson(STORAGE_BOOKINGS, bookings);

      setMsg($("#quickBookingMsg"),
        `Request saved ‚úÖ Your Service ID (demo) is ${booking.service_id}.`,
        true
      );

      this.reset();
      $(this).removeClass("was-validated");

      renderAdmin();
    });

    // Booking modal (stores + shows Service ID)
    $("#bookingForm").on("submit", function(e){
      e.preventDefault();
      if (!validateForm(this)) return;

      const booking = toObject(this);
      booking.createdAt = new Date().toISOString();
      booking.service_id = generateServiceId();
      booking.status = "Booked";

      const bookings = getJson(STORAGE_BOOKINGS);
      bookings.unshift(booking);
      setJson(STORAGE_BOOKINGS, bookings);

      setMsg($("#bookingMsg"),
        `Booking saved ‚úÖ Your Service ID (demo) is ${booking.service_id}. Use it later to leave a review.`,
        true
      );

      renderAdmin();

      this.reset();
      $(this).removeClass("was-validated");
    });

    // Review submit
    $("#reviewForm").on("submit", function(e){
      e.preventDefault();

      // manual rating validation
      const rating = Number($("#ratingInput").val() || 0);
      if (!rating) {
        $("#ratingError").css("display", "block");
        setMsg($("#reviewMsg"), "Please select a rating.", false);
        return;
      }

      if (!validateForm(this)) return;

      const payload = toObject(this);
      payload.rating = rating;
      payload.createdAt = new Date().toISOString();

      const serviceId = (payload.service_id || "").trim().toUpperCase();
      payload.service_id = serviceId;

      const bookings = getJson(STORAGE_BOOKINGS);
      const booking = bookings.find(b => (b.service_id || "").toUpperCase() === serviceId);

      if (!booking) {
        setMsg($("#reviewMsg"), "Invalid Service ID. Please check your Service ID and try again.", false);
        return;
      }

      const reviews = getJson(STORAGE_REVIEWS);

      // prevent duplicate review for same service id
      if (reviews.some(r => (r.service_id || "").toUpperCase() === serviceId)) {
        setMsg($("#reviewMsg"), "A review is already submitted for this Service ID.", false);
        return;
      }

      // attach customer name (optional)
      payload.customer_name = booking.name || "Customer";

      reviews.unshift(payload);
      setJson(STORAGE_REVIEWS, reviews);

      setMsg($("#reviewMsg"), "Thank you! Your review was submitted successfully.", true);

      this.reset();
      $(this).removeClass("was-validated");
      setStars(0);

      renderTestimonials();
      renderAdmin();
    });

    // Admin actions
    $("#refreshAdmin").on("click", function(){
      renderAdmin();
      renderTestimonials();
    });

    $("#clearAll").on("click", function(){
      localStorage.removeItem(STORAGE_BOOKINGS);
      localStorage.removeItem(STORAGE_REVIEWS);
      renderAdmin();
      renderTestimonials();
    });

    $("#exportAll").on("click", function(){
      const data = {
        bookings: getJson(STORAGE_BOOKINGS),
        reviews:  getJson(STORAGE_REVIEWS)
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "site-data.json";
      a.click();
      URL.revokeObjectURL(url);
    });

    // default stars
    setStars(0);
  });
</script>

</body>
</html>
